<section class="feature-center">
  <div class="feature-card">
    <h2>Wallets</h2>

    <div *ngIf="showCta" class="callout">
      <strong>¡Bienvenido!</strong> Crea tu primera wallet para comenzar.
    </div>

    <div *ngIf="created" class="success">
      <div>
        <strong>Wallet creada</strong>
        <span *ngIf="createdFirst"> — Tu primera wallet está lista.</span>
        <div class="muted small">Clave pública: <code>{{ created.pub_key }}</code></div>
      </div>
      <a [routerLink]="['/txs']" [queryParams]="{ from: created.id, pub: created.pub_key }" class="btn primary">Enviar</a>
    </div>

    <form class="tools" (submit)="$event.preventDefault(); create();">
      <input type="text" placeholder="Nombre de la wallet" [(ngModel)]="name" name="name" />
      <button class="btn primary" type="submit" [disabled]="loading || !name.trim()">Nueva wallet</button>
    </form>

    <div *ngIf="error" class="error">{{ error }}</div>

    <div *ngIf="loading && !wallets.length" class="skeleton-list">
      <div class="skeleton-row" *ngFor="let _ of [1,2,3,4]"></div>
    </div>

    <table *ngIf="!loading && wallets.length" class="table">
      <thead>
        <tr>
          <th>Nombre</th>
          <th class="balance">Fondos (SIM)</th>
          <th class="balance">Fondos (BTC)</th>
          <th class="balance">≈ USD</th>
          <th class="pubkey">Clave Pública</th>
          <th class="created">Creada</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let w of wallets">
          <td>
            <div class="wallet-name">{{ w.name }}</div>
            <div class="wallet-id muted">#{{ w.id }}</div>
          </td>
          <td class="balance">{{ balanceSimOf(w.id) | number:'1.2-2' }}</td>
          <td class="balance">{{ balanceBtcOf(w.id) !== null ? (balanceBtcOf(w.id)! | number:'1.8-8') : '—' }}</td>
          <td class="balance">{{ balanceUsdOf(w.id) !== null ? (balanceUsdOf(w.id)! | number:'1.2-2') : '—' }}</td>
          <td class="pubkey"><code>{{ w.pub_key }}</code></td>
          <td class="created">{{ w.created_at | date:'medium' }}</td>
          <td class="right"><button class="btn" (click)="remove(w.id)">Eliminar</button></td>
        </tr>
      </tbody>
    </table>

    <p class="muted" *ngIf="!loading && !wallets.length">Aún no tienes wallets. Crea la primera.</p>
  </div>
</section>
