<section class="feature-center">
  <div class="feature-card">
    <h2>Transacciones</h2>

    <div *ngIf="error" class="error">{{ error }}</div>

    <div *ngIf="loading" class="skeleton-list"><div class="skeleton-row" *ngFor="let _ of [1,2,3,4,5]"></div></div>

    <table *ngIf="!loading && visibleTransactions.length" class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Desde</th>
          <th>Hacia</th>
          <th>Monto</th>
          <th>Fee</th>
          <th>Estado</th>
          <th>Block</th>
          <th>Acciones</th>
          <th>Fecha</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let tx of visibleTransactions">
          <td>#{{ tx.id }}</td>
          <td>
            <div>{{ tx.from_wallet_name }} (#{{ tx.from_wallet }})</div>
            <small class="muted">@{{ tx.from_username || '—' }} (user #{{ tx.from_user || '—' }})</small>
            <small class="muted">hash: {{ tx.tx_hash | slice:0:12 }}…</small>
          </td>
          <td>
            <div>{{ tx.to_wallet_name || '-' }} (#{{ tx.to_wallet }})</div>
            <small class="muted">@{{ tx.to_username || '—' }} (user #{{ tx.to_user || '—' }})</small>
          </td>
          <td>{{ tx.amount | number:'1.2-2' }}</td>
          <td>{{ tx.fee | number:'1.2-2' }}</td>
          <td><span class="status" [class.pending]="tx.status==='PENDING'" [class.confirmed]="tx.status==='CONFIRMED'" [class.failed]="tx.status==='FAILED'">{{ tx.status }}</span></td>
          <td>{{ tx.block ?? '—' }}</td>
          <td>
            <ng-container *ngIf="tx.status==='PENDING'; else noActions">
              <select [(ngModel)]="confirmBlockId[tx.id]" name="block_{{tx.id}}" [disabled]="sending">
                <option [ngValue]="null">Crear bloque nuevo</option>
                <option *ngFor="let b of blocks" [ngValue]="b.id">#{{ b.id }} (h={{ b.height }})</option>
              </select>
              <button class="btn small" type="button" (click)="confirmTx(tx)" [disabled]="sending">Confirmar</button>
              <button class="btn small outline" type="button" (click)="failTx(tx)" [disabled]="sending">Fallar</button>
            </ng-container>
            <ng-template #noActions>—</ng-template>
          </td>
          <td>{{ tx.created_at | date:'medium' }}</td>
        </tr>
      </tbody>
    </table>

    <p class="muted" *ngIf="!loading && !transactions.length">Aún no hay transacciones.</p>
  </div>
</section>
